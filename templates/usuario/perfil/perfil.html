<!doctype html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Meu Perfil - Biblioteca</title>

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css"
    />

    <style>
      body {
        background-color: #f8f9fa;
      }
      .sidebar {
        background: linear-gradient(180deg, #2c3e50 0%, #1a252f 100%);
        color: white;
        min-height: 100vh;
      }
      .sidebar .nav-link {
        color: #ecf0f1;
        padding: 12px 20px;
        margin: 2px 0;
        border-radius: 5px;
      }
      .sidebar .nav-link:hover {
        background: rgba(255, 255, 255, 0.1);
        color: white;
      }
      .sidebar .nav-link.active {
        background: #3498db;
        color: white;
      }
      .card-stat {
        border-radius: 10px;
        border: none;
        transition: transform 0.3s;
      }
      .card-stat:hover {
        transform: translateY(-5px);
      }
      .user-avatar {
        width: 80px;
        height: 80px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 2rem;
        color: white;
        margin: 0 auto;
      }
    </style>
  </head>

  <body>
    <div class="container-fluid">
      <div class="row">
        <!-- SIDEBAR -->
        <nav class="col-md-3 col-lg-2 d-md-block sidebar collapse">
          <div class="position-sticky pt-3">
            <div class="sidebar-header p-4 border-bottom text-center">
              <div class="user-avatar mb-3">
                <i class="bi bi-person-circle"></i>
              </div>
              <h5 class="mb-0">
                {{ user.get_full_name|default:user.username }}
              </h5>
              <small class="text-muted d-block mt-2">{{ user.email }}</small>
              {% if perfil %}
              <span class="badge bg-secondary mt-2"
                >{{ perfil.get_categoria_display }}</span
              >
              {% endif %}
            </div>

            <ul class="nav flex-column">
              <li class="nav-item">
                <a class="nav-link active" href="/perfil/"
                  ><i class="bi bi-speedometer2"></i> Meu Dashboard</a
                >
              </li>
              <li class="nav-item mt-3">
                <small class="text-uppercase text-muted">Livros</small>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="/acervo/"
                  ><i class="bi bi-book"></i> Acervo</a
                >
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#meus-emprestimos"
                  ><i class="bi bi-clock-history"></i> Empréstimos</a
                >
              </li>
              <li class="nav-item mt-3">
                <small class="text-uppercase text-muted">Conta</small>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#meus-dados"
                  ><i class="bi bi-person"></i> Meus Dados</a
                >
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#historico"
                  ><i class="bi bi-clock-history"></i> Histórico</a
                >
              </li>
              <li class="nav-item mt-3">
                <small class="text-uppercase text-muted">Sistema</small>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="/informacoes/"
                  ><i class="bi bi-info-circle"></i> Informações</a
                >
              </li>
              <li class="nav-item">
                <a class="nav-link" href="/logout/"
                  ><i class="bi bi-box-arrow-right"></i> Sair</a
                >
              </li>
            </ul>
          </div>
        </nav>

        <!-- MAIN -->
        <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
          <div
            class="d-flex justify-content-between align-items-center pt-3 pb-2 mb-3 border-bottom"
          >
            <h1 class="h2"><i class="bi bi-speedometer2"></i> Meu Dashboard</h1>
            <span class="badge bg-primary"
              ><i class="bi bi-calendar3"></i> {% now "d/m/Y" %}</span
            >
          </div>

          {% if messages %} {% for message in messages %}
          <div
            class="alert alert-{{ message.tags }} alert-dismissible fade show"
          >
            {{ message }}
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="alert"
            ></button>
          </div>
          {% endfor %} {% endif %}

          <!-- DADOS -->
          <div class="card shadow mb-4" id="meus-dados">
            <div class="card-header">
              <h6 class="m-0 font-weight-bold text-primary">Meus Dados</h6>
            </div>
            <div class="card-body">
              <table class="table">
                <tr>
                  <th>Nome:</th>
                  <td>{{ user.get_full_name|default:"Não informado" }}</td>
                </tr>
                <tr>
                  <th>Usuário:</th>
                  <td>{{ user.username }}</td>
                </tr>
                <tr>
                  <th>Email:</th>
                  <td>{{ user.email }}</td>
                </tr>
                {% if perfil %}
                <tr>
                  <th>Telefone:</th>
                  <td>{{ perfil.telefone }}</td>
                </tr>
                <tr>
                  <th>Categoria:</th>
                  <td>{{ perfil.get_categoria_display }}</td>
                </tr>
                {% endif %}
              </table>
            </div>
          </div>

          <!-- EMPRÉSTIMOS -->
          <div class="card shadow mb-4" id="meus-emprestimos">
            <div class="card-header">
              <h6 class="m-0 font-weight-bold text-primary">
                Meus Empréstimos
              </h6>
            </div>
            <div class="card-body">
              {% if emprestimos_ativos %}
              <table class="table table-hover">
                <thead>
                  <tr>
                    <th>Livro</th>
                    <th>Devolução</th>
                    <th>Dias</th>
                    <th>Status</th>
                  </tr>
                </thead>
                <tbody>
                  {% for emprestimo in emprestimos_ativos %}
                  <tr>
                    <td>{{ emprestimo.livro.titulo }}</td>
                    <td>
                      {{ emprestimo.data_devolucao_prevista|date:"d/m/Y" }}
                    </td>

                    <td>
                      {% if emprestimo.dias_restantes > 0 %}
                      <span class="text-success"
                        >{{ emprestimo.dias_restantes }} dias</span
                      >
                      {% elif emprestimo.dias_restantes == 0 %}
                      <span class="text-warning">Hoje</span>
                      {% else %}
                      <span class="text-danger"
                        >{{ emprestimo.dias_restantes|stringformat:"+d"|cut:"-"
                        }} dias atrasado</span
                      >
                      {% endif %}
                    </td>

                    <td>
    {% if emprestimo.status == 'ativo' %}
        {% if emprestimo.dias_restantes > 0 %}
            <span class="badge bg-success">No Prazo</span>
        {% else %}
            <span class="badge bg-danger">Atrasado</span>
        {% endif %}
    {% else %}
        <span class="badge bg-secondary">
            {{ emprestimo.get_status_display }}
        </span>
    {% endif %}
</td>

                  </tr>
                  {% endfor %}
                </tbody>
              </table>

              {% else %}
              <div class="text-center py-5">
                <h4 class="text-muted">Nenhum empréstimo ativo</h4>
              </div>
              {% endif %}
            </div>
          </div>

          <!-- HISTÓRICO -->
          <div class="card shadow" id="historico">
            <div class="card-header">
              <h6 class="m-0 font-weight-bold text-primary">Histórico</h6>
            </div>
            <div class="card-body">
    {% if emprestimos_historico %}
        <div class="table-responsive">
            <table class="table table-sm">
                <thead>
                    <tr>
                        <th>Livro</th>
                        <th>Data Empréstimo</th>
                        <th>Data Devolução</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    {% for emprestimo in emprestimos_historico %}
                    <tr>
                        <td>{{ emprestimo.livro.titulo }}</td>
                        <td>{{ emprestimo.data_emprestimo|date:"d/m/Y" }}</td>
                        <td>
                            {% if emprestimo.data_devolucao_real %}
                                {{ emprestimo.data_devolucao_real|date:"d/m/Y" }}
                            {% else %}
                                -
                            {% endif %}
                        </td>
                        <td>
                            <span class="badge bg-secondary">
                                {{ emprestimo.get_status_display }}
                            </span>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% else %}
        <p class="text-muted">Nenhum histórico disponível</p>
    {% endif %}
</div>

          </div>
        </main>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
